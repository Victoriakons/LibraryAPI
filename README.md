1. alembic upgrade head - выполнить миграции в базу данных (из корневой папки)
   uvicorn main:app --reload - запускаем FastAPI (на сервере http://localhost:8000) (запуск из корневой папки)
   Далее можно запустить интеграционные тесты (test.py, test2.py, test3.py)



2. Реализация бизнес-логики
  Выдача книги (borrow_book)
- Проверка, что книга существует и есть доступные экземпляры (считаем, сколько экземпляров уже выдано без возврата).
- Проверка, что читатель существует.
- Проверка, что у читателя не более 3 одновременно выданных книг (по borrowed_books с return_date = NULL).
- Если все условия выполнены, создается запись о выдаче, количество экземпляров не изменяется в таблице книг (так как copies — общее количество, а доступность вычисляется динамически).

Сложности и решения:
Нужно правильно считать доступные экземпляры — реализовано через подсчет активных записей в borrowed_books.
Проверка лимита книг на читателя — дополнительный запрос с фильтром по return_date = NULL.



  Возврат книги (return_book)
- При возврате проверяется, что запись о выдаче существует и книга не возвращена.
- Проставляется дата возврата.
- Количество доступных экземпляров автоматически увеличивается, так как условие выдачи считает количество «живых» заимствований.

  Сложности и решения:
  Проверка корректности возврата по конкретной записи.
  Избегание повторного возврата.


  Дополнительные ограничения
- Нельзя выдать книгу, если нет свободных экземпляров.
- Один читатель не может иметь более 3 активных выдач.

3. Реализация аутентификации
Используется JWT (JSON Web Token) с помощью библиотеки PyJWT (или встроенной поддержки в FastAPI Security).
При логине пользователь получает токен с зашифрованным payload, где хранится идентификатор пользователя и время истечения (exp).
Токен возвращается клиенту и передается в заголовке Authorization: Bearer <token> в защищенных эндпоинтах.
В эндпоинтах с защитой (Depends(get_current_user)) токен декодируется и валидируется:

- Проверяется подпись, срок действия, существование пользователя.

- Защищены все операции, связанные с CRUD книг и читателей, а также выдачей и возвратом книг.

- Эндпоинты регистрации/логина (аутентификации) открыты.

Почему JWT:

Без состояния на сервере — не нужно хранить сессии.
Стандартный способ аутентификации в REST API.
